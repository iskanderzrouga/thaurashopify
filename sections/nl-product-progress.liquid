{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top_m }}px;
    padding-bottom: {{ section.settings.padding_bottom_m }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Smooth transition animations */
  .product-progress__image {
    opacity: 0;
    transform: scale(0.95);
    transition: opacity 450ms cubic-bezier(0.4, 0.0, 0.2, 1),
                transform 450ms cubic-bezier(0.4, 0.0, 0.2, 1);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-progress__image.active {
    opacity: 1;
    transform: scale(1);
    position: relative;
  }

  .product-progress__description {
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 450ms cubic-bezier(0.4, 0.0, 0.2, 1) 50ms,
                transform 450ms cubic-bezier(0.4, 0.0, 0.2, 1) 50ms;
    position: absolute;
    pointer-events: none;
  }

  .product-progress__description.active {
    opacity: 1;
    transform: translateY(0);
    position: relative;
    pointer-events: auto;
  }

  .product-progress__tab {
    transition: all 300ms cubic-bezier(0.4, 0.0, 0.2, 1);
  }

  /* Image container to maintain aspect ratio */
  .product-progress__image-container {
    position: relative;
    width: 100%;
    min-height: 300px;
  }

  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .product-progress__image,
    .product-progress__description,
    .product-progress__tab {
      transition: none !important;
    }
  }
{%- endstyle -%}

<div id="{{ section.settings.section_id }}" class="section-{{ section.id }}-padding px-5 relative" style="background-color: {{ section.settings.bgcolor }}">
  {% if section.settings.bg != blank %}
    {{
      section.settings.bg
      | image_url: width: 1920
      | image_tag: class: 'absolute top-0 left-0 w-full h-full object-cover hidden md:block', preload: true
    }}
  {% endif %}

  {% if section.settings.bg_mobile != blank %}
    {{
      section.settings.bg_mobile
      | image_url: width: 768
      | image_tag: class: 'absolute top-0 left-0 w-full h-full object-cover block md:hidden', preload: true
    }}
  {% endif %}

  <div class="mx-auto w-full relative" style="max-width: {{ section.settings.max_width }}px;">
    <div class="flex flex-col items-center justify-center gap-6 md:gap-12">
      {% if section.blocks.size > 0 %}
        <div class="flex flex-col md:grid md:grid-cols-5 bg-white rounded-[12px] border border-[#1C5934]">
          <div class="md:col-span-2 product-progress__image-container rounded-tl-[12px] md:rounded-bl-[12px] rounded-tr-[12px] md:rounded-tr-[0px] overflow-hidden">
            {% for block in section.blocks %}
              {% case block.type %}
                {% when 'row' %}
                  {% if block.settings.image != blank %}
                    {% assign image_class = 'product-progress__image w-full rounded-tl-[12px] md:rounded-bl-[12px] rounded-tr-[12px] md:rounded-tr-[0px]' %}
                    {% if forloop.first %}
                      {% assign image_class = 'product-progress__image active w-full rounded-tl-[12px] md:rounded-bl-[12px] rounded-tr-[12px] md:rounded-tr-[0px]' %}
                    {% endif %}
                    {{
                      block.settings.image
                      | image_url: width: 500
                      | image_tag: class: image_class, sizes: '500px', data-index: forloop.index
                    }}
                  {% endif %}
              {% endcase %}
            {% endfor %}
          </div>
          <div class="md:col-span-3 px-4 py-5 md:p-[30px] w-full h-full flex flex-col justify-center gap-5 md:gap-[30px]">
            {% if section.settings.heading != blank %}
              <h2 class="text-[26px] md:text-[36px] font-bold !leading-tight text-[#00754A] text-center md:text-left">
                {{ section.settings.heading }}
              </h2>
            {% endif %}

            <div class="grid grid-cols-2 md:flex items-center gap-2 md:gap-4 flex-wrap">
              {% for block in section.blocks %}
                {% if block.settings.heading != blank %}
                  <div
                    data-index="{{ forloop.index }}"
                    class="product-progress__tab text-center {% if forloop.first %} active {% endif %} cursor-pointer text-[14px] md:text-[16px] font-normal px-5 py-2 border border-[#084C25] rounded-[70px] !leading-tight text-[#084C25] [&.active]:text-white [&.active]:border-[#084C25] [&.active]:bg-[#084C25]"
                  >
                    {{ block.settings.heading }}
                  </div>
                {% endif %}
              {% endfor %}
            </div>

            <div class="relative min-h-[120px]">
              {% for block in section.blocks %}
                <div
                  class="product-progress__description {% if forloop.first %} active {% endif %}"
                  data-index="{{ forloop.index }}"
                >
                  <div class="flex flex-col gap-3 text-center md:text-left">
                    {% if block.settings.subheading != blank %}
                      <div class="text-[20px] md:text-[24px] font-bold !leading-[1.5] text-[#000]">
                        {{ block.settings.subheading }}
                      </div>
                    {% endif %}

                    {% if block.settings.description != blank %}
                      <div class="text-[16px] md:text-[17px] font-normal !leading-[1.5] text-[#000]">
                        {{ block.settings.description }}
                      </div>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endif %}

      {% if section.settings.description != blank %}
        <div class="text-[15px] md:text-[15px] font-normal !leading-[1.5] text-[#000] text-center">
          {{ section.settings.description }}
        </div>
      {% endif %}

      <div class="w-full flex flex-col items-center justify-center gap-[10px]">
      {% if section.settings.button_label != blank %}
        <div class="w-full max-w-[500px] mx-auto">
          <a href="{{ section.settings.button_url }}" class="new-button--{{section.settings.button_type}} nl-smooth-scroll-btn">
            {{ section.settings.button_label }}
            {% if section.settings.button_type == 'primary' %}
              {%- render 'icon-arrow-right' -%}
            {% elsif section.settings.button_type == 'secondary' %}
              {%- render 'icon-arrow-right-secondary' -%}
            {% endif %}
          </a>
        </div>
      {% endif %}

        {% if section.settings.product_bottom_label != blank %}
          <div class="flex items-center gap-2 mt-3 md:mt-4 relative w-fit mx-auto">
            {% if section.settings.bottom_label_icon != blank %}
              {{
                section.settings.bottom_label_icon
                | image_url: width: 24
                | image_tag: class: 'w-full max-w-[20px] md:max-w-[24px]'
              }}
            {% endif %}

            <div
              class="text-[15px] md:text-[15px] text-[#000] font-normal !leading-tight"
              style="color: {{ section.settings.text_color }};"
            >
              {{ section.settings.product_bottom_label }}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  // Smooth scroll functionality
  document.querySelectorAll('.nl-smooth-scroll-btn').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
      var href = this.getAttribute('href');
      if (href && href.startsWith('#')) {
        e.preventDefault();
        var target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    });
  });

  (function() {
    let isInitialLoad = true;
    let isAnimating = false;

    document.querySelectorAll('.product-progress__tab').forEach((tabButton) => {
      tabButton.addEventListener('click', function () {
        // Prevent multiple clicks during animation
        if (isAnimating) return;

        const dataId = tabButton.getAttribute('data-index');
        const newImage = document.querySelector(`.product-progress__image[data-index="${dataId}"]`);
        const newDescription = document.querySelector(`.product-progress__description[data-index="${dataId}"]`);

        // Check if the tab is already active
        if (tabButton.classList.contains('active')) return;
        if (!newImage || !newDescription) return;

        isAnimating = true;

        // Remove active state from all tabs
        document.querySelectorAll('.product-progress__tab').forEach((oneElement) => {
          oneElement.classList.remove('active');
        });
        tabButton.classList.add('active');

        // Fade out current image and description
        document.querySelectorAll('.product-progress__image.active').forEach((oneElement) => {
          oneElement.classList.remove('active');
        });

        document.querySelectorAll('.product-progress__description.active').forEach((oneElement) => {
          oneElement.classList.remove('active');
        });

        // Small delay to ensure the fade-out starts, then fade in new content
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            newImage.classList.add('active');
            newDescription.classList.add('active');
          });
        });

        // Reset animation lock after transition completes
        setTimeout(() => {
          isAnimating = false;
        }, 500); // 450ms transition + 50ms buffer
      });
    });

    // Mark initial load complete after a short delay
    setTimeout(() => {
      isInitialLoad = false;
    }, 100);
  })();
</script>

{% schema %}
{
  "name": "NL Product Progress",
  "settings": [
    {
      "type": "text",
      "id": "section_id",
      "label": "Section ID"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "select",
      "id": "button_type",
      "options": [
        {
          "value": "primary",
          "label": "Primary"
        },
        {
          "value": "secondary",
          "label": "Secondary"
        },
        {
          "value": "tertiary",
          "label": "Tertiary"
        }
      ],
      "default": "primary",
      "label": "Button Type"
    },
    {
      "type": "text",
      "id": "product_bottom_label",
      "label": "Product Bottom Label"
    },
    {
      "type": "image_picker",
      "id": "bottom_label_icon",
      "label": "Bottom Label Icon"
    },
    {
      "type": "color",
      "id": "bgcolor",
      "label": "background Color",
      "default": "#ffffff"
    },
    {
      "type": "image_picker",
      "id": "bg",
      "label": "background Image"
    },
    {
      "type": "image_picker",
      "id": "bg_mobile",
      "label": "background Image (Mobile)"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 600,
      "max": 1800,
      "step": 20,
      "unit": "px",
      "label": "Max Width",
      "default": 1200
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 72
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 72
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top (Mobile)",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom (Mobile)",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "row",
      "name": "Row",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "NL Product Progress"
    }
  ]
}
{% endschema %}
